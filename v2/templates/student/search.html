<link rel="stylesheet" href="css/search.css">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

<main id="Search">
    <div class="content">
        <div class="hero">
            <h1>Cerca l'azienda che fa per te</h1>
            <div class="searchWrapper">
                <input type="text" placeholder="Search" id="search_input" name="search">
                <select name="regione" id="regione">
                    <option value="lombardia">lombardia</option>
                    <option value="lazio">lazio</option>
                    <option value="sicilia">sicilia</option>
                </select>
                <select name="provincia" id="provincia">
                    <option value="brescia">brescia</option>
                    <option value="roma">roma</option>
                    <option value="palermo">palermo</option>
                </select>
                <button id="searchbtn">SEARCH</button>
            </div>
        </div>
        <div style="margin-top: 3vh;">
            <div id="searchResult" class="cardList">
                <span></span>
            </div>
        </div>
    </div>
</main>

<script>
    function searchSuccess(response) {
        document.getElementById("searchResult").innerHTML = "";
        response.map((obj) => {
            let business = document.createElement("div");
            let link = document.createElement("a");
            let img = document.createElement("img");
            let businessName = document.createElement("h3");
            let businessField = document.createElement("h5");
            let businessHeadQuarter = document.createElement("h5");

            business.classList.add("card");
            link.href = "";
            link.id = obj.id_business;
            img.src = obj.logo;
            businessName.innerText = obj.name;
            businessField.innerText = obj.field;
            businessHeadQuarter.innerText = obj.city;

            link.addEventListener("click", (e) => {
                e.preventDefault();
                localStorage.setItem("business", JSON.stringify(obj));
                window.dispatchEvent(new Event("NewBusinessEvent"));
                document.querySelectorAll("main").forEach((frame) => {
                    frame.style.display = "none";
                });
                document.getElementById("Business").style.display = "block";
            });

            link.appendChild(img);
            link.appendChild(businessName);
            link.appendChild(businessField);
            link.appendChild(businessHeadQuarter);

            business.appendChild(link);

            document.getElementById("searchResult").appendChild(business);
        })
    }

    document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("searchbtn").addEventListener("click", () => {
            let searchtxt = document.getElementById("search_input").value;
            let regione = document.getElementById("regione").value;
            let provincia = document.getElementById("provincia").value;
            $.ajax({
                url: './includes/stdFunc.php',
                type: 'post',
                data: { "searchBusiness": "1", "search": searchtxt, "regione": regione, "provincia": provincia},
                success: searchSuccess
            });
        });
    });
</script>